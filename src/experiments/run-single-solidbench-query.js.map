{"version":3,"file":"run-single-solidbench-query.js","sourceRoot":"","sources":["run-single-solidbench-query.ts"],"names":[],"mappings":"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","sourcesContent":["import { resourceLimits } from 'worker_threads';\nimport { ComunicaRunner } from '../packages/comunica-runner';\nimport { queries } from '../queries/solidbench-queries';\nimport { StatisticLinkDiscovery } from '@comunica/statistic-link-discovery';\nimport { LoggerPretty } from '@comunica/logger-pretty';\n\n// runSingleQuery(runner, queries.d_1_1, 100);\nrunSingleQuery(queries.d_8_5, 8);\n// runSingleQueryStreaming(runner, bottleNeckQueries.traversal, 1);\n\nasync function runSingleQuery(query: string, repeats: number, runner?: ComunicaRunner){\n    const totalTimeTaken = [];\n    const firstTs = [];\n    const lastTs = [];\n    const nResults = [];\n    for (let i = 0; i < repeats; i++){\n        const runner = new ComunicaRunner();\n        console.log(process.memoryUsage())\n        console.log(`${i+1}/${repeats}`);\n\n        // let links = 0;\n        // let intermediateResults = 0;\n        // const statistic = new StatisticLinkDiscovery();\n        // const linksEmitted: Set<string> = new Set();\n        // const statisticIntermediateResults = new StatisticIntermediateResults();\n        // statistic.on((data) => {\n        //     if (!linksEmitted.has(data.edge[1])){\n        //         linksEmitted.add(data.edge[1]);\n        //         links++;\n        //     }\n        // });\n        // statisticIntermediateResults.on((data) => {\n        //     intermediateResults++\n        // });\n        // const timestamps = [];\n        // const start = performance.now();\n        const bs = await runner.executeQuery(query, {\n            \"lenient\": true, \n            noCache: true,\n            // log: new LoggerPretty({ level: 'debug' })\n            // [statistic.key.name]: statistic,\n            // [statisticIntermediateResults.key.name]: statisticIntermediateResults\n        });\n        const result = await trackTimestamps(bs);\n        console.log(result);\n        totalTimeTaken.push(result.endTime);\n        firstTs.push(result.timestamps[0]);\n        lastTs.push(result.timestamps[result.timestamps.length-1]);\n        nResults.push(result.nResults);\n        // const result = await bs.toArray();\n\n        // const timeTaken = (performance.now() - start)/1000;\n        // totalTimeTaken.push(timeTaken);\n        console.log(`${(totalTimeTaken[totalTimeTaken.length-1]).toFixed(4)} seconds, ${nResults[nResults.length-1]} results`);    \n        if (global.gc) {\n            global.gc();\n        } else {\n            console.log('Garbage collection unavailable.  Pass --expose-gc '\n              + 'when launching node to enable forced garbage collection.');\n        }\n        sleep(5000);\n        // console.log(`${result.length} results, ${links} links, and ${intermediateResults} intermediate results\n        // in ${(timeTaken).toFixed(4)} seconds`\n        // );    \n    }\n    const {mean, std} = getStats(totalTimeTaken);\n    const {mean: meanFirst, std: stdFirst}  = getStats(firstTs);\n    const {mean: meanLast, std: stdLast} = getStats(lastTs);\n    console.log(`Execution time: ${mean}(${std})`);\n    console.log(`First ts: ${meanFirst}(${stdFirst})`);\n    console.log(`Last ts: ${meanLast}(${stdLast})`);\n}\n\nfunction trackTimestamps(bs: NodeJS.ReadableStream): Promise<{ timestamps: number[], endTime: number, nResults: number }> {\n    return new Promise((resolve, reject) => {\n        const start = performance.now();\n        const timestamps: number[] = [];\n        let nResults = 0;\n\n        bs.on('data', () => {\n            timestamps.push((performance.now() - start) / 1000);\n            nResults += 1;\n            console.log(\"Got data\")\n        });\n\n        bs.on('end', () => {\n            const endTime = (performance.now() - start) / 1000;\n            resolve({ timestamps, endTime, nResults });\n        });\n        bs.on('error', (err) => {\n            console.log(err);\n            const endTime = (performance.now() - start) / 1000;\n            reject({timestamps, endTime, nResults })\n        })\n    });\n}\n\nasync function runSingleQueryStreaming(runner: ComunicaRunner, query: string, repeats: number){\n    for (let i = 0; i < repeats; i++){\n        console.log(`${i+1}/${repeats}`)\n        let links = 0;\n        const statistic = new StatisticLinkDiscovery()\n        statistic.on((data) => {\n            links++;\n        });\n        const bs = await runner.executeQuery(query, {\n            \"lenient\": true, \n            [statistic.key.name]: statistic,\n        });\n        const start = performance.now();\n        bs.on('data', () => {\n            console.log(`Result after: ${(performance.now() - start)/1000} seconds`);\n        });\n        bs.on('end', () => {\n            console.log(`${links} links in ${(performance.now()-start)/1000} seconds`);\n        });\n    }\n}\n\nfunction getStats(arr: number[]): { mean: number; std: number } {\n    if (arr.length === 0) return { mean: 0, std: 0 };\n  \n    const mean = arr.reduce((sum, val) => sum + val, 0) / arr.length;\n  \n    const variance =\n      arr.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / arr.length;\n  \n    const std = Math.sqrt(variance);\n  \n    return { mean, std };\n}\n\nfunction sleep(ms: number) {\n    return new Promise((resolve) => {\n      setTimeout(resolve, ms);\n    });\n  }\n// \"Type-index: 5.01260620078\"\n// BFS Execution time: 5.151359135539996(0.40667891642476683)\n// Type-Index Execution Time: 5.1037558031700065(0.5047199817937335)\n`\nType Index:\nExecution time: 4.784637267709996(0.420810544381306)\nFirst ts: 0.9192274094399958(0.1947151810088686)\nLast ts: 1.1635524492999962(0.5465982741765153)\nBFS:\nExecution time: 5.0480078823199985(0.5673089988421482)\nFirst ts: 1.08714607718(0.6613737574271775)\nLast ts: 1.3708740904099992(0.8669249627766322)\n`\n"]}